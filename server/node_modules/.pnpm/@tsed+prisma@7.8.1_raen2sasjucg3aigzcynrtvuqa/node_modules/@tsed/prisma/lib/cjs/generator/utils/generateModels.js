"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateModels = void 0;
const tslib_1 = require("tslib");
const core_1 = require("@tsed/core");
const path_1 = tslib_1.__importDefault(require("path"));
const DmmfModel_1 = require("../domain/DmmfModel");
const transformModelToClass_1 = require("../transform/transformModelToClass");
const generateDocuments_1 = require("./generateDocuments");
const generateOutputsBarrelFile_1 = require("./generateOutputsBarrelFile");
function generateModels(dmmf, project, baseDirPath) {
    const modelsMap = (0, core_1.toMap)((0, core_1.getValue)(dmmf, "datamodel.models", []), "name");
    const typesMap = (0, core_1.toMap)((0, core_1.getValue)(dmmf, "datamodel.types", []), "name");
    const models = DmmfModel_1.DmmfModel.getModels(dmmf, modelsMap, typesMap);
    const modelsDirPath = path_1.default.resolve(baseDirPath, "models");
    const modelsDirectory = project.createDirectory(modelsDirPath);
    const modelsIndex = modelsDirectory.createSourceFile(`index.ts`, undefined, { overwrite: true });
    const exportedModels = (0, generateDocuments_1.generateDocuments)(models, modelsDirectory, (model, sourceFile) => {
        return (0, transformModelToClass_1.transformModelToClass)(model, {
            dmmf,
            modelsMap
        });
    });
    (0, generateOutputsBarrelFile_1.generateOutputsBarrelFile)(modelsIndex, exportedModels);
}
exports.generateModels = generateModels;
//# sourceMappingURL=generateModels.js.map
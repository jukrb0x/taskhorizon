{"version":3,"file":"isCircularRef.js","sourceRoot":"","sources":["../../../../src/generator/utils/isCircularRef.ts"],"names":[],"mappings":"AAGA,MAAM,UAAU,aAAa,CAAC,SAAiB,EAAE,SAAiB,EAAE,GAAqB;IACvF,IAAI,SAAS,KAAK,SAAS,EAAE;QAC3B,OAAO,IAAI,CAAC;KACb;IAED,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IAC/C,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IAE/C,OAAO,OAAO,CAAC,SAAS,IAAI,SAAS,IAAI,gBAAgB,CAAC,SAAS,EAAE,SAAS,EAAE,GAAG,CAAC,IAAI,gBAAgB,CAAC,SAAS,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC,CAAC;AACvI,CAAC;AAED,SAAS,gBAAgB,CAAC,KAAiB,EAAE,QAAgB,EAAE,GAAqB,EAAE,YAAsB,EAAE;IAC5G,OAAO,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;QACnC,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE;YAC3B,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;YACnC,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAEhD,IAAI,SAAS,EAAE;gBACb,OAAO,gBAAgB,CAAC,SAAS,EAAE,QAAQ,EAAE,GAAG,EAAE,CAAC,GAAG,SAAS,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;aAC/E;SACF;QAED,OAAO,KAAK,CAAC;IACf,CAAC,CAAC,CAAC;AACL,CAAC","sourcesContent":["import {TransformContext} from \"../domain/TransformContext\";\nimport {DMMF} from \"@prisma/generator-helper\";\n\nexport function isCircularRef(modelName: string, fieldType: string, ctx: TransformContext): boolean {\n  if (modelName === fieldType) {\n    return true;\n  }\n\n  const relation1 = ctx.modelsMap.get(modelName);\n  const relation2 = ctx.modelsMap.get(fieldType);\n\n  return Boolean(relation1 && relation2 && hasModelInFields(relation1, fieldType, ctx) && hasModelInFields(relation2, modelName, ctx));\n}\n\nfunction hasModelInFields(model: DMMF.Model, relation: string, ctx: TransformContext, inspected: string[] = []): boolean {\n  return !!model.fields.find((field) => {\n    if (field.type === relation) {\n      return true;\n    }\n\n    if (!inspected.includes(field.type)) {\n      const nextModel = ctx.modelsMap.get(field.type);\n\n      if (nextModel) {\n        return hasModelInFields(nextModel, relation, ctx, [...inspected, field.type]);\n      }\n    }\n\n    return false;\n  });\n}\n"]}
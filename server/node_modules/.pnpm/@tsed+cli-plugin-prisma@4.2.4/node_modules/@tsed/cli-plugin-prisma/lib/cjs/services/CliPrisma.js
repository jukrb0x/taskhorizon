"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CliPrisma = void 0;
const tslib_1 = require("tslib");
const cli_core_1 = require("@tsed/cli-core");
const di_1 = require("@tsed/di");
let CliPrisma = class CliPrisma {
    cliExeca;
    cliFs;
    projectPackageJson;
    run(command, args = [], options = {}) {
        return this.cliExeca.run("npx", ["prisma", command, ...args], {
            ...options,
            cwd: this.projectPackageJson.dir
        });
    }
    init() {
        return this.run("init");
    }
    async patchPrismaSchema() {
        const schemaPath = this.cliFs.join(this.projectPackageJson.dir, "prisma", "schema.prisma");
        if (this.cliFs.exists(schemaPath)) {
            let content = await this.cliFs.readFile(schemaPath, "utf8");
            if (!content.includes("generator tsed")) {
                content += "\ngenerator tsed {\n" + '  provider = "tsed-prisma"\n' + "}\n";
                content +=
                    "\nmodel User {\n" +
                        "  id    Int     @default(autoincrement()) @id\n" +
                        "  email String  @unique\n" +
                        "  name  String?\n" +
                        "}\n";
                return this.cliFs.writeFile(schemaPath, content, { encoding: "utf8" });
            }
        }
    }
};
tslib_1.__decorate([
    (0, cli_core_1.Inject)(),
    tslib_1.__metadata("design:type", cli_core_1.CliExeca)
], CliPrisma.prototype, "cliExeca", void 0);
tslib_1.__decorate([
    (0, cli_core_1.Inject)(),
    tslib_1.__metadata("design:type", cli_core_1.CliFs)
], CliPrisma.prototype, "cliFs", void 0);
tslib_1.__decorate([
    (0, cli_core_1.Inject)(),
    tslib_1.__metadata("design:type", cli_core_1.ProjectPackageJson)
], CliPrisma.prototype, "projectPackageJson", void 0);
CliPrisma = tslib_1.__decorate([
    (0, di_1.Injectable)()
], CliPrisma);
exports.CliPrisma = CliPrisma;
//# sourceMappingURL=CliPrisma.js.map
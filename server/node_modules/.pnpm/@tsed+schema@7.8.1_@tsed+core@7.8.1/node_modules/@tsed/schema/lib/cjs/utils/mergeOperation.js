"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mergeOperation = void 0;
const SpecTypes_1 = require("../domain/SpecTypes");
const concatParameters_1 = require("./concatParameters");
const getJsonPathParameters_1 = require("./getJsonPathParameters");
/**
 * @ignore
 */
function mergeOperation(obj, operation, { rootPath, specType, operationId, defaultTags, tags, path, method }) {
    const pathParameters = (0, getJsonPathParameters_1.getJsonPathParameters)(rootPath, path).map(({ path, parameters }) => {
        path = path ? path : "/";
        // FIXME not on the right place
        if (specType === SpecTypes_1.SpecTypes.OPENAPI) {
            parameters = parameters.map(({ type, ...param }) => {
                return {
                    ...param,
                    schema: {
                        type
                    }
                };
            });
        }
        return { path, parameters };
    });
    return pathParameters.reduce((obj, { path, parameters }) => {
        parameters = (0, concatParameters_1.concatParameters)(parameters, operation);
        path = path ? path : "/";
        const operationTags = operation.tags?.length ? operation.tags : [defaultTags];
        obj.paths[path] = {
            ...obj.paths[path],
            [method.toLowerCase()]: {
                operationId: operation.operationId || operationId(path),
                ...operation,
                tags: operationTags.map(({ name }) => name),
                parameters
            }
        };
        tags.push(...operationTags);
        return obj;
    }, obj);
}
exports.mergeOperation = mergeOperation;
//# sourceMappingURL=mergeOperation.js.map
{"version":3,"file":"LayoutReplacer.js","sourceRoot":"","sources":["../../../../src/layouts/class/LayoutReplacer.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,MAAM,IAAI,CAAC;AACzB,OAAO,KAAK,IAAI,MAAM,MAAM,CAAC;AAC7B,aAAa;AACb,OAAO,KAAK,UAAU,MAAM,aAAa,CAAC;AAE1C,OAAO,EAAC,UAAU,EAAC,MAAM,wBAAwB,CAAC;AAClD,OAAO,EAAC,WAAW,EAAE,aAAa,EAAC,MAAM,wBAAwB,CAAC;AAIlE,MAAM,GAAG,GAAG,EAAE,CAAC,GAAG,IAAI,IAAI,CAAC;AAE3B,MAAM,OAAO,cAAc;IACL;IAAgC;IAApD,YAAoB,MAAsB,EAAU,cAAsB;QAAtD,WAAM,GAAN,MAAM,CAAgB;QAAU,mBAAc,GAAd,cAAc,CAAQ;IAAG,CAAC;IAE9E;;;;;OAKG;IACI,YAAY,GAAG,CAAC,YAAsB,EAAE,SAAiB,EAAU,EAAE;QAC1E,IAAI,UAAU,GAAG,YAAY,CAAC,YAAY,CAAC;QAC3C,IAAI,SAAS,EAAE;YACb,MAAM,SAAS,GAAG,QAAQ,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAC1C,MAAM,cAAc,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC7C,IAAI,SAAS,GAAG,cAAc,CAAC,MAAM,EAAE;gBACrC,UAAU,GAAG,cAAc,CAAC,KAAK,CAAC,cAAc,CAAC,MAAM,GAAG,SAAS,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aAChF;SACF;QACD,OAAO,UAAU,CAAC;IACpB,CAAC,CAAC;IACF;;;;;OAKG;IACI,YAAY,GAAG,CAAC,YAAsB,EAAE,SAAiB,EAAU,EAAE;QAC1E,IAAI,MAAM,GAAG,UAAU,CAAC,cAAc,CAAC;QACvC,IAAI,SAAS,EAAE;YACb,MAAM,GAAG,SAAS,CAAC;YACnB,wBAAwB;YACxB,IAAI,MAAM,KAAK,SAAS,EAAE;gBACxB,MAAM,GAAG,UAAU,CAAC,cAAc,CAAC;aACpC;iBAAM,IAAI,MAAM,KAAK,wBAAwB,EAAE;gBAC9C,MAAM,GAAG,UAAU,CAAC,6BAA6B,CAAC;aACnD;iBAAM,IAAI,MAAM,KAAK,UAAU,EAAE;gBAChC,MAAM,GAAG,UAAU,CAAC,mBAAmB,CAAC;aACzC;iBAAM,IAAI,MAAM,KAAK,MAAM,EAAE;gBAC5B,MAAM,GAAG,UAAU,CAAC,eAAe,CAAC;aACrC;SACF;QACD,kBAAkB;QAClB,OAAO,UAAU,CAAC,QAAQ,CAAC,MAAM,EAAE,YAAY,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;IAClF,CAAC,CAAC;IACF;;;OAGG;IACI,QAAQ,GAAG,GAAW,EAAE;QAC7B,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC;IAClC,CAAC,CAAC;IACF;;;;OAIG;IACI,aAAa,GAAG,CAAC,YAAsB,EAAU,EAAE;QACxD,OAAQ,IAAI,CAAC,MAAc,CAAC,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;IACpD,CAAC,CAAC;IAEK,UAAU,GAAG,CAAC,YAAsB,EAAU,EAAE;QACrD,OAAO,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;IAC3C,CAAC,CAAC;IACF;;;OAGG;IACI,SAAS,GAAG,GAAG,EAAE;QACtB,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;IACF;;;;OAIG;IACI,QAAQ,GAAG,CAAC,YAAsB,EAAU,EAAE;QACnD,OAAO,YAAY,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;IACvC,CAAC,CAAC;IACF;;;;OAIG;IACI,SAAS,GAAG,CAAC,YAAsB,EAAU,EAAE;QACpD,OAAO,UAAU,CAAC,QAAQ,CAAC,UAAU,EAAE,YAAY,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;IACtF,CAAC,CAAC;IACF;;;;OAIG;IACI,WAAW,GAAG,CAAC,YAAsB,EAAU,EAAE;QACtD,MAAM,KAAK,GAAQ,YAAY,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjD,OAAO,aAAa,CAAC,UAAU,CAAC,KAAgC,CAAC,CAAC,CAAC;IACrE,CAAC,CAAC;IACF;;;;OAIG;IACI,SAAS,GAAG,CAAC,YAAsB,EAAU,EAAE;QACpD,MAAM,KAAK,GAAQ,YAAY,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjD,OAAO,WAAW,CAAC,UAAU,CAAC,KAAgC,CAAC,CAAC,CAAC;IACnE,CAAC,CAAC;IACF;;;OAGG;IACI,OAAO,GAAG,GAAG,EAAE;QACpB,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;IACF;;;;OAIG;IACI,GAAG,GAAG,CAAC,YAAuB,EAAU,EAAE;QAC/C,OAAO,YAAY,IAAI,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;IACjG,CAAC,CAAC;IACF;;;;;OAKG;IACI,WAAW,GAAG,CAAC,YAAsB,EAAE,SAAiB,EAAE,EAAE;QACjE,IAAI,YAAY,CAAC,OAAO,IAAI,SAAS,EAAE;YACrC,OAAO,SAAS;iBACb,OAAO,CAAC,IAAI,EAAE,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC;iBAC1C,OAAO,CAAC,IAAI,EAAE,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC;iBAC1C,OAAO,CAAC,IAAI,EAAE,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SACjD;aAAM,IAAI,YAAY,CAAC,OAAO,EAAE;YAC/B,OAAO,GAAG,YAAY,CAAC,OAAO,CAAC,MAAM,IAAI,YAAY,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;SACxE;QAED,OAAO,IAAI,CAAC,GAAG,EAAE,CAAC;IACpB,CAAC,CAAC;IACF;;;;;OAKG;IACI,WAAW,GAAG,CAAC,YAAsB,EAAE,SAAiB,EAAE,EAAE;QACjE,IAAI,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,WAAW,EAAE;YACjD,OAAO,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;SACrH;QAED,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,KAAK;QACH,OAAO;YACL,CAAC,EAAE,IAAI,CAAC,YAAY;YACpB,CAAC,EAAE,IAAI,CAAC,YAAY;YACpB,CAAC,EAAE,IAAI,CAAC,QAAQ;YAChB,CAAC,EAAE,IAAI,CAAC,aAAa;YACrB,CAAC,EAAE,IAAI,CAAC,UAAU;YAClB,CAAC,EAAE,IAAI,CAAC,SAAS;YACjB,CAAC,EAAE,IAAI,CAAC,QAAQ;YAChB,CAAC,EAAE,IAAI,CAAC,SAAS;YACjB,GAAG,EAAE,IAAI,CAAC,WAAW;YACrB,GAAG,EAAE,IAAI,CAAC,SAAS;YACnB,CAAC,EAAE,IAAI,CAAC,WAAW;YACnB,CAAC,EAAE,IAAI,CAAC,GAAG;YACX,GAAG,EAAE,IAAI,CAAC,OAAO;YACjB,CAAC,EAAE,IAAI,CAAC,WAAW;SACpB,CAAC;IACJ,CAAC;CACF","sourcesContent":["import * as Os from \"os\";\nimport * as Util from \"util\";\n// @ts-ignore\nimport * as dateFormat from \"date-format\";\nimport {LogEvent} from \"../../core/LogEvent\";\nimport {LOG_COLORS} from \"../constants/logColors\";\nimport {colorizeEnd, colorizeStart} from \"../utils/colorizeUtils\";\nimport {IReplacers} from \"../interfaces/Replacers\";\nimport {TokensHandlers} from \"../interfaces/BasicLayoutConfiguration\";\n\nconst eol = Os.EOL || \"\\n\";\n\nexport class LayoutReplacer {\n  constructor(private tokens: TokensHandlers, private timezoneOffset: number) {}\n\n  /**\n   *\n   * @param loggingEvent\n   * @param specifier\n   * @returns {any}\n   */\n  public categoryName = (loggingEvent: LogEvent, specifier: string): string => {\n    let loggerName = loggingEvent.categoryName;\n    if (specifier) {\n      const precision = parseInt(specifier, 10);\n      const loggerNameBits = loggerName.split(\".\");\n      if (precision < loggerNameBits.length) {\n        loggerName = loggerNameBits.slice(loggerNameBits.length - precision).join(\".\");\n      }\n    }\n    return loggerName;\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @param specifier\n   * @returns {any}\n   */\n  public formatAsDate = (loggingEvent: LogEvent, specifier: string): string => {\n    let format = dateFormat.ISO8601_FORMAT;\n    if (specifier) {\n      format = specifier;\n      // Pick up special cases\n      if (format === \"ISO8601\") {\n        format = dateFormat.ISO8601_FORMAT;\n      } else if (format === \"ISO8601_WITH_TZ_OFFSET\") {\n        format = dateFormat.ISO8601_WITH_TZ_OFFSET_FORMAT;\n      } else if (format === \"ABSOLUTE\") {\n        format = dateFormat.ABSOLUTETIME_FORMAT;\n      } else if (format === \"DATE\") {\n        format = dateFormat.DATETIME_FORMAT;\n      }\n    }\n    // Format the date\n    return dateFormat.asString(format, loggingEvent.startTime, this.timezoneOffset);\n  };\n  /**\n   *\n   * @returns {string}\n   */\n  public hostname = (): string => {\n    return Os.hostname().toString();\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @returns {any}\n   */\n  public formatMessage = (loggingEvent: LogEvent): string => {\n    return (Util.format as any)(...loggingEvent.data);\n  };\n\n  public formatJson = (loggingEvent: LogEvent): string => {\n    return JSON.stringify(loggingEvent.data);\n  };\n  /**\n   *\n   * @returns {string|string}\n   */\n  public endOfLine = () => {\n    return eol;\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @returns {string}\n   */\n  public logLevel = (loggingEvent: LogEvent): string => {\n    return loggingEvent.level.toString();\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @returns {any}\n   */\n  public startTime = (loggingEvent: LogEvent): string => {\n    return dateFormat.asString(\"hh:mm:ss\", loggingEvent.startTime, this.timezoneOffset);\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @returns {string}\n   */\n  public startColour = (loggingEvent: LogEvent): string => {\n    const index: any = loggingEvent.level.toString();\n    return colorizeStart(LOG_COLORS[index as keyof typeof LOG_COLORS]);\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @returns {string}\n   */\n  public endColour = (loggingEvent: LogEvent): string => {\n    const index: any = loggingEvent.level.toString();\n    return colorizeEnd(LOG_COLORS[index as keyof typeof LOG_COLORS]);\n  };\n  /**\n   *\n   * @returns {string}\n   */\n  public percent = () => {\n    return \"%\";\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @returns {string}\n   */\n  public pid = (loggingEvent?: LogEvent): string => {\n    return loggingEvent && loggingEvent.pid ? loggingEvent.pid.toString() : process.pid.toString();\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @param specifier\n   * @returns {any}\n   */\n  public clusterInfo = (loggingEvent: LogEvent, specifier: string) => {\n    if (loggingEvent.cluster && specifier) {\n      return specifier\n        .replace(\"%m\", loggingEvent.cluster.master)\n        .replace(\"%w\", loggingEvent.cluster.worker)\n        .replace(\"%i\", loggingEvent.cluster.workerId);\n    } else if (loggingEvent.cluster) {\n      return `${loggingEvent.cluster.worker}@${loggingEvent.cluster.master}`;\n    }\n\n    return this.pid();\n  };\n  /**\n   *\n   * @param loggingEvent\n   * @param specifier\n   * @returns {any}\n   */\n  public userDefined = (loggingEvent: LogEvent, specifier: string) => {\n    if (typeof this.tokens[specifier] !== \"undefined\") {\n      return typeof this.tokens[specifier] === \"function\" ? this.tokens[specifier](loggingEvent) : this.tokens[specifier];\n    }\n\n    return null;\n  };\n\n  build(): IReplacers {\n    return {\n      c: this.categoryName,\n      d: this.formatAsDate,\n      h: this.hostname,\n      m: this.formatMessage,\n      j: this.formatJson,\n      n: this.endOfLine,\n      p: this.logLevel,\n      r: this.startTime,\n      \"[\": this.startColour,\n      \"]\": this.endColour,\n      y: this.clusterInfo,\n      z: this.pid,\n      \"%\": this.percent,\n      x: this.userDefined\n    };\n  }\n}\n"]}